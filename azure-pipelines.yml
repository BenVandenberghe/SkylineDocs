trigger:
- master
- az-devops

pool:
  vmImage: windows-2019

steps:
- powershell: |
    choco install docfx -y
    docfx docfx.json -o _site
    if ($lastexitcode -ne 0){
      throw ("Error generating document")
    }
  displayName: "docfx build"
- powershell: |
    git clone https://github.com/docascode/docfx-seed.git -b gh-pages _origin_site -q
    Remove-Item _origin_site/* -Exclude _origin_site/.git -Recurse
    Copy-Item _site/* _origin_site -Recurse -Force
    Set-Location _origin_site
    git config core.safecrlf false # disable LF/CRLF check to avoid break Azure Pipelines
    git add .
    git commit -m "Update documents" -q
    exec "git -c http.extraheader='AUTHORIZATION: basic $env:BASIC_AUTH_TOKEN' push origin gh-pages -q"
  displayName: "docfx publish"
  env:
    BASIC_AUTH_TOKEN: $(BASIC_AUTH_TOKEN)